
package GUI.ModuloRegistrarEntrada;

import DTOs.EmpleadoCargadoDTO;
import DTOs.EntradaDTO;
import DTOs.ProductoEntradaDTO;
import Exception.InventarioException;
import Exception.NegocioException;
import Exception.VentaException;
import GUI.Aplicacion;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.DefaultListModel;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author HP
 */
public class InformacionRegistrarEntrada extends javax.swing.JPanel {
    private Aplicacion app;
    private List<ProductoEntradaDTO> listadoProductosEntrada = new ArrayList<>();
    private EntradaDTO entrada;
    /**
     * Creates new form NuevoRegistrarEntrada
     */
    public InformacionRegistrarEntrada(Aplicacion app) {
        this.app = app;
        initComponents();
        try {
            valoresDefault();
        } catch (InventarioException ex) {
            Logger.getLogger(InformacionRegistrarEntrada.class.getName()).log(Level.SEVERE, null, ex);
        }
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        labelTitulo = new javax.swing.JLabel();
        labelEmpleado = new javax.swing.JLabel();
        labelFecha = new javax.swing.JLabel();
        BtnRegistrarEntrada = new javax.swing.JButton();
        BtnAgregarProducto = new javax.swing.JButton();
        BtnCancelar = new javax.swing.JButton();
        labelSubtotal = new javax.swing.JLabel();
        campoSubtotal = new javax.swing.JTextField();
        labelTotal = new javax.swing.JLabel();
        CampoTotal = new javax.swing.JTextField();
        labelIva = new javax.swing.JLabel();
        CampoIva = new javax.swing.JTextField();
        tablaProductosEntrada = new javax.swing.JScrollPane();
        TablaProductoEntrada = new javax.swing.JTable();
        BtnAgregarProductoEntrada = new javax.swing.JButton();

        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        labelTitulo.setFont(new java.awt.Font("Segoe UI", 0, 36)); // NOI18N
        labelTitulo.setText("Informacion Entrada");
        add(labelTitulo, new org.netbeans.lib.awtextra.AbsoluteConstraints(80, 40, -1, -1));

        labelEmpleado.setMaximumSize(new java.awt.Dimension(350, 70));
        labelEmpleado.setMinimumSize(new java.awt.Dimension(100, 70));
        labelEmpleado.setPreferredSize(new java.awt.Dimension(350, 70));
        add(labelEmpleado, new org.netbeans.lib.awtextra.AbsoluteConstraints(780, 10, -1, 60));

        labelFecha.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        labelFecha.setText("Fecha:");
        add(labelFecha, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 600, -1, -1));

        BtnRegistrarEntrada.setBackground(new java.awt.Color(204, 204, 204));
        BtnRegistrarEntrada.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        BtnRegistrarEntrada.setText("Confirmar Entrada");
        BtnRegistrarEntrada.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnRegistrarEntradaMouseClicked(evt);
            }
        });
        add(BtnRegistrarEntrada, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 510, 240, 110));

        BtnAgregarProducto.setBackground(new java.awt.Color(204, 204, 204));
        BtnAgregarProducto.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        BtnAgregarProducto.setText("Nuevo Producto");
        BtnAgregarProducto.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnAgregarProductoMouseClicked(evt);
            }
        });
        add(BtnAgregarProducto, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 410, 240, 50));

        BtnCancelar.setBackground(new java.awt.Color(204, 204, 204));
        BtnCancelar.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        BtnCancelar.setText("Cancelar Registro");
        BtnCancelar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnCancelarMouseClicked(evt);
            }
        });
        add(BtnCancelar, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 320, 240, 40));

        labelSubtotal.setText("Subtotal");
        add(labelSubtotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 110, -1, -1));
        add(campoSubtotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 130, 160, -1));

        labelTotal.setText("Total");
        labelTotal.setToolTipText("");
        add(labelTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 210, -1, -1));
        add(CampoTotal, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 230, 160, -1));

        labelIva.setText("IVA");
        add(labelIva, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 160, -1, -1));
        add(CampoIva, new org.netbeans.lib.awtextra.AbsoluteConstraints(820, 180, 160, -1));

        TablaProductoEntrada.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Producto", "Cantidad", "Precio compra", "Importe"
            }
        ));
        TablaProductoEntrada.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                TablaProductoEntradaMouseClicked(evt);
            }
        });
        tablaProductosEntrada.setViewportView(TablaProductoEntrada);

        add(tablaProductosEntrada, new org.netbeans.lib.awtextra.AbsoluteConstraints(30, 100, 670, 330));

        BtnAgregarProductoEntrada.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        BtnAgregarProductoEntrada.setText("+");
        BtnAgregarProductoEntrada.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnAgregarProductoEntradaMouseClicked(evt);
            }
        });
        add(BtnAgregarProductoEntrada, new org.netbeans.lib.awtextra.AbsoluteConstraints(710, 100, 70, 50));
    }// </editor-fold>//GEN-END:initComponents

    private void BtnRegistrarEntradaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnRegistrarEntradaMouseClicked

        entrada = app.getEntradaTemporal();
        try {
            entrada.setEmpleado(app.cargarEmpleado());
            int resultado = JOptionPane.showConfirmDialog(null, "Â¿Desea registrar la entrada?", "Confirmacion", JOptionPane.YES_NO_OPTION);
       
            if (resultado == JOptionPane.YES_OPTION) {
                app.registrarEntrada(entrada);
                JOptionPane.showMessageDialog(null, "Entrada registrada exitosamente.", "Exito", JOptionPane.INFORMATION_MESSAGE);
                app.mostrarMenuOpciones();
            } else {
                JOptionPane.showMessageDialog(null, "Registro cancelado.", "Cancelacion", JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (InventarioException ex) {
            Logger.getLogger(InformacionRegistrarEntrada.class.getName()).log(Level.SEVERE, null, ex);
        } catch (VentaException ex) {
            Logger.getLogger(InformacionRegistrarEntrada.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_BtnRegistrarEntradaMouseClicked

    private void BtnAgregarProductoMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnAgregarProductoMouseClicked
        // TODO add your handling code here:
        app.mostrarVentanaProductoNuevo();
    }//GEN-LAST:event_BtnAgregarProductoMouseClicked

    private void BtnCancelarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnCancelarMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_BtnCancelarMouseClicked

    private void TablaProductoEntradaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_TablaProductoEntradaMouseClicked
        // TODO add your handling code here:
        if(evt.getClickCount() == 2){
                    //control.EliminarProductoEntrada(tablaProductosEntrada.getSelectedRow()); estos metodos los puedo reutilizar desde RegistrarVenta (panel)
        }
        //Actualizar la tabla para eliminar el producto
    }//GEN-LAST:event_TablaProductoEntradaMouseClicked

    private void BtnAgregarProductoEntradaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnAgregarProductoEntradaMouseClicked
        // TODO add your handling code here:
        if(evt.getClickCount()==1){
            try {
                app.mostrarVentanaSeleccionarProductosEntrada();
            } catch (NegocioException ex) {
                Logger.getLogger(InformacionRegistrarEntrada.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
        
    }//GEN-LAST:event_BtnAgregarProductoEntradaMouseClicked


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BtnAgregarProducto;
    private javax.swing.JButton BtnAgregarProductoEntrada;
    private javax.swing.JButton BtnCancelar;
    private javax.swing.JButton BtnRegistrarEntrada;
    private javax.swing.JTextField CampoIva;
    private javax.swing.JTextField CampoTotal;
    private javax.swing.JTable TablaProductoEntrada;
    private javax.swing.JTextField campoSubtotal;
    private javax.swing.JLabel labelEmpleado;
    private javax.swing.JLabel labelFecha;
    private javax.swing.JLabel labelIva;
    private javax.swing.JLabel labelSubtotal;
    private javax.swing.JLabel labelTitulo;
    private javax.swing.JLabel labelTotal;
    private javax.swing.JScrollPane tablaProductosEntrada;
    // End of variables declaration//GEN-END:variables

 public void crearTablaProductosEntrada(){ 
     //quite el codigo del producto 
        String StringprecioCompra;
        String Total;
        String subtotal;
        String iva;
        String Stringimporte;
        double importe;
        double precioCompra;
        double subtotalTemporal =0.0;
        String columnasTabla[] = {"Nombre","unidad", "Precio de Compra", "Importe"};
        TablaProductoEntrada.setRowHeight(25);
        DefaultTableModel modelo = new DefaultTableModel(columnasTabla, 0){
            @Override
            public boolean  isCellEditable(int fila, int columna){
                return false;
            }                    
        };
        TablaProductoEntrada.setRowSelectionAllowed(true);
        TablaProductoEntrada.setColumnSelectionAllowed(false);
        TablaProductoEntrada.getTableHeader().setReorderingAllowed(false);
        TablaProductoEntrada.getTableHeader().setResizingAllowed(false);
            for(ProductoEntradaDTO producto : app.cargarProductosEntrada()){
                precioCompra = producto.getPrecioCompra();
                StringprecioCompra = String.format("%.2f", precioCompra);
                importe = producto.getUnidad()*producto.getPrecioCompra();
                Stringimporte = String.format("%.2f", importe);
                modelo.addRow(new Object[]{
                    producto.getProductoEntrada().getNombre(),
                    producto.getUnidad(),
                    StringprecioCompra,
                    Stringimporte 
                    }               
                );           
                subtotalTemporal+=importe;  
            }
        TablaProductoEntrada.setModel(modelo);
        double IVA = app.calcularIVAEntrada(subtotalTemporal);
        double total =  app.calcularTotalEntrada(IVA, subtotalTemporal);
        subtotal = String.format("%.2f", subtotalTemporal);
        Total = String.format("%.2f", total);
        iva = String.format("%.2f", IVA);
        campoSubtotal.setText(subtotal);
        CampoIva.setText(iva);
        CampoTotal.setText(Total);
        app.setIVATemporalEntrada(IVA);
        app.setSubtotalTemporalEntrada(subtotalTemporal);
        app.setTotalTemporalTemporalEntrada(total);
        
    }
 
    public void valoresDefault() throws InventarioException{
        try {
            labelFecha.setText("Fecha: " + LocalDateTime.now().toString());
            labelEmpleado.setText("Empleado: "+ app.cargarEmpleado().getNombre());
            crearTablaProductosEntrada();
            revalidate();
            repaint();
        } catch (VentaException ex) {
            throw new InventarioException("Error al cargar Empleado");
        }
    }





}
